import{d as g,u as C,r as V,a as K,o as M,c as B,b as d,e as c,f as l,F as w,g as $,h as u,w as T,v as E,i as x,t as y,n as U,p as I,j as S,_ as L,k as m,l as O}from"./index-fffc9a92.js";var p=(s=>(s[s.Ok=200]="Ok",s[s.BadRequest=400]="BadRequest",s[s.InteralServerError=500]="InteralServerError",s))(p||{});const D=s=>(I("data-v-b77d68c2"),s=s(),S(),s),H={flex:"","flex-col":"","flex-1":"","p-1":"","pl-0":""},N={class:"flex-1 w-full m-auto p-4 rounded-lg box-border overflow-hidden"},j={key:0,class:"message"},q={key:1,class:"message !float-right"},A=D(()=>l("div",{class:"clearfix"},null,-1)),F={class:"mt-4"},z={class:"flex w-full h-4em px-4 my-4 box-border"},G=["onKeydown"],J=g({__name:"ChatView",setup(s){const r=C(),a=V({editContent:"",editing:!1}),n=K();M(()=>{n.value&&n.value.scrollTo({top:n.value.scrollHeight})});const _=B(()=>r.current.messages),h=()=>{U(()=>{n.value&&(n.value.scrollTop=n.value.scrollHeight)})},f=async o=>{if(o&&(o.preventDefault(),!o.metaKey&&!o.ctrlKey)||a.editing)return;if(!a.editContent){window.alert("请输入信息");return}r.current.messages.push({sentBy:"human",content:a.editContent}),h(),a.editContent="";const{uuid:e}=r.current;try{const t=await window.fetch("/api/chat",{body:JSON.stringify({prompt:_.value[_.value.length-1].content,conversation_id:e}),headers:{"Content-Type":"application/json"},method:"POST"});let i;switch(t.status){case p.Ok:t.json().then(k=>{r.current.messages.push({sentBy:"chat-gpt",content:k.ai_text}),r.rooms[e]=r.current,h()});break;case p.BadRequest:i="请求参数错误";break;case p.InteralServerError:i="服务器错误";break;default:i="未知错误"}if(i!==void 0)throw new Error(`${i}，请重新发送消息`)}catch(t){window.alert(t.message)}},v=()=>{window.fetch("/api/reset").then(()=>{r.resetChatroom(r.current.uuid),console.log(r.current)})};return(o,e)=>(d(),c("div",H,[l("div",N,[l("div",{ref_key:"messagesBox",ref:n,class:"h-full overflow-auto transition-all"},[(d(!0),c(w,null,$(u(_),(t,i)=>(d(),c(w,{key:i},[t.sentBy==="chat-gpt"?(d(),c("div",j,y(t.content),1)):(d(),c("div",q,y(t.content),1)),A],64))),128))],512)]),l("div",F,[l("div",z,[T(l("textarea",{"onUpdate:modelValue":e[0]||(e[0]=t=>a.editContent=t),contenteditable:"",class:"flex-1 p-2 b-gray-300 b-solid b-2 rounded-lg",onCompositionstart:e[1]||(e[1]=()=>a.editing=!0),onCompositionend:e[2]||(e[2]=()=>a.editing=!1),onKeyup:e[3]||(e[3]=x(t=>t.preventDefault(),["enter"])),onKeydown:x(f,["enter"])},null,40,G),[[E,a.editContent]]),l("button",{class:"button",title:"【Ctrl/Meta + Enter】发送",onClick:e[4]||(e[4]=()=>f())}," Submit "),l("button",{class:"button",onClick:v}," Clear ")])])]))}});const P=L(J,[["__scopeId","data-v-b77d68c2"]]),Q=["xlink:href"],b=g({__name:"BaseIcon",props:{fileUrl:{default:"icons.svg"},id:null},setup(s){const r=s,a=B(()=>`${r.fileUrl}#${r.id}`);return(n,_)=>(d(),c("svg",null,[l("use",{"xlink:href":u(a)},null,8,Q)]))}}),R=s=>(I("data-v-cc82e62c"),s=s(),S(),s),W={"w-50":"","p-1":"","box-border":"","leading-3em":"","text-left":"",bg:"gray-7",text:"white"},X=R(()=>l("span",{"ml-2":""},"New Chat",-1)),Y=["onKeydown"],Z=["data-chatroom-uuid"],tt=["onUpdate:modelValue","data-chatroom-uuid","onBlur"],et=["data-chatroom-uuid"],ot=g({__name:"ChatroomList",setup(s){const r=o=>o.getAttribute("data-chatroom-uuid"),a=o=>o.getAttribute("data-action"),n=C(),_=o=>{if(o.target instanceof HTMLElement||o.target instanceof SVGElement){const e=r(o.target),t=a(o.target);if(e)if(t==="delete"){if(Object.keys(n.rooms).length===1)return;if(delete n.rooms[e],e===n.current.uuid){const i=n.getChatroomsByIndex();n.current=i[i.length-1]}}else n.current=n.rooms[e]}},h=o=>{if(o.target instanceof HTMLElement){const e=r(o.target);if(e){const t=n.rooms[e];t&&(t.editTitle=!0)}}},f=o=>{const e=n.rooms[o];e.title===""&&(e.title="No name"),e.editTitle=!1},v=o=>{if(o.target instanceof HTMLElement){const e=r(o.target);if(e){const t=n.rooms[e];t&&t.editTitle&&(t.editTitle=!1)}}};return(o,e)=>(d(),c("div",W,[l("div",{b:"1 solid gray-4 rounded-lg",class:"list-item",onClick:e[0]||(e[0]=t=>u(n).addChatroom())},[m(u(b),{id:"add","w-1.8em":"","h-1.8em":""}),X]),l("ul",{"list-none":"","p-0":"","w-full":"","box-border":"",onClick:_,onDblclick:h,onKeydown:x(v,["enter"])},[(d(!0),c(w,null,$(u(n).getChatroomsByIndex(),t=>(d(),c("li",{key:t.uuid,"data-chatroom-uuid":t.uuid,class:O(["list-item leading-0 py-5 !px-3 mb-2 group",{"bg-dark-500/40":u(n).current.uuid===t.uuid}]),hover:"bg-dark-500/40","data-action":"switch"},[m(u(b),{id:"chat","w-1.5em":"","h-1.5em":"","min-w-1.5em":"","data-chatroom-uuid":t.uuid},null,8,["data-chatroom-uuid"]),t.editTitle?T((d(),c("input",{key:0,"onUpdate:modelValue":i=>t.title=i,"inline-block":"","flex-1":"","w-30":"","ml-2":"",type:"text","data-chatroom-uuid":t.uuid,onBlur:i=>f(t.uuid)},null,40,tt)),[[E,t.title]]):(d(),c("span",{key:1,"inline-block":"","flex-1":"","ml-3":"","data-chatroom-uuid":t.uuid},y(t.title),9,et)),m(u(b),{id:"delete","w-1em":"","h-1em":"","display-none":"",absolute:"","right-2":"","top-2":"","group-hover":"block","data-chatroom-uuid":t.uuid,"data-action":"delete"},null,8,["data-chatroom-uuid"])],10,Z))),128))],40,Y)]))}});const nt=L(ot,[["__scopeId","data-v-cc82e62c"]]),st={class:"text-dark-300 flex w-100vw h-100vh box-border"},at=g({__name:"index",setup(s){return(r,a)=>(d(),c("div",st,[m(nt),m(P)]))}});export{at as default};
