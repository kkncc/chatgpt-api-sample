import{d as f,u as x,r as E,c as y,o as r,a as i,b as d,F as v,e as k,f as l,w as C,v as $,t as w,p as B,g as T,_ as I,h as p,i as S,n as L}from"./index-bab582ff.js";var h=(s=>(s[s.Ok=200]="Ok",s[s.BadRequest=400]="BadRequest",s[s.InteralServerError=500]="InteralServerError",s))(h||{});const V=s=>(B("data-v-978172a3"),s=s(),T(),s),U={flex:"","flex-col":"","flex-1":"","p-1":"","pl-0":""},O={class:"flex-1 w-full m-auto p-4 rounded-lg box-border"},N={key:0,class:"message"},D={key:1,class:"message !float-right"},M=V(()=>d("div",{class:"clearfix"},null,-1)),j={class:"mt-4"},q={class:"flex w-full h-4em px-4 my-4 box-border"},H=f({__name:"ChatView",setup(s){const a=x(),n=E({editContent:"",editing:!1}),c=y(()=>a.current.messages),m=async u=>{if(u==null||u.preventDefault(),n.editing)return;if(!n.editContent){window.alert("请输入信息");return}a.current.messages.push({sentBy:"human",content:n.editContent}),n.editContent="";const{uuid:o}=a.current;try{const e=await window.fetch("/api/chat",{body:JSON.stringify({prompt:c.value[c.value.length-1].content,conversation_id:o}),headers:{"Content-Type":"application/json"},method:"POST"});let t;switch(e.status){case h.Ok:e.json().then(_=>{a.rooms[o].messages.push({sentBy:"chat-gpt",content:_.ai_text})});break;case h.BadRequest:t="请求参数错误";break;case h.InteralServerError:t="服务器错误";break;default:t="未知错误"}if(t!==void 0)throw new Error(`${t}，请重新发送消息`)}catch(e){window.alert(e.message)}},g=()=>{window.fetch("/api/reset").then(()=>{a.resetChatroom(a.current.uuid),console.log(a.current)})};return(u,o)=>(r(),i("div",U,[d("div",O,[(r(!0),i(v,null,k(l(c),(e,t)=>(r(),i(v,{key:t},[e.sentBy==="chat-gpt"?(r(),i("div",N,w(e.content),1)):(r(),i("div",D,w(e.content),1)),M],64))),128))]),d("div",j,[d("div",q,[C(d("textarea",{"onUpdate:modelValue":o[0]||(o[0]=e=>n.editContent=e),contenteditable:"",class:"flex-1 p-2 b-gray-300 b-solid b-2 rounded-lg",onCompositionstart:o[1]||(o[1]=()=>n.editing=!0),onCompositionend:o[2]||(o[2]=()=>n.editing=!1)},null,544),[[$,n.editContent]]),d("button",{class:"button",onClick:m}," Submit "),d("button",{class:"button",onClick:g}," Clear ")])])]))}});const K=I(H,[["__scopeId","data-v-978172a3"]]),F=["xlink:href"],b=f({__name:"BaseIcon",props:{fileUrl:{default:"icons.svg"},id:null},setup(s){const a=s,n=y(()=>`${a.fileUrl}#${a.id}`);return(c,m)=>(r(),i("svg",null,[d("use",{"xlink:href":l(n)},null,8,F)]))}}),P=s=>(B("data-v-c61c8707"),s=s(),T(),s),z={"w-50":"","p-1":"","box-border":"","leading-3em":"","text-left":"",bg:"gray-7",text:"white"},A=P(()=>d("span",{"ml-2":""},"New Chat",-1)),J=["onKeydown"],G=["data-chatroom-uuid"],Q=["onUpdate:modelValue","data-chatroom-uuid","onBlur"],R=["data-chatroom-uuid"],W=f({__name:"ChatroomList",setup(s){const a=o=>o.getAttribute("data-chatroom-uuid"),n=x(),c=o=>{if(o.target instanceof HTMLLIElement){const e=a(o.target);e&&(n.current=n.rooms[e])}},m=o=>{if(o.target instanceof HTMLElement){const e=a(o.target);if(e){const t=n.rooms[e];t&&(t.editTitle=!0)}}},g=o=>{const e=n.rooms[o];e.title===""&&(e.title="No name"),e.editTitle=!1},u=o=>{if(o.target instanceof HTMLElement){const e=a(o.target);if(e){const t=n.rooms[e];t&&t.editTitle&&(t.editTitle=!1)}}};return(o,e)=>(r(),i("div",z,[d("div",{b:"1 solid gray-4 rounded-lg",class:"list-item",onClick:e[0]||(e[0]=t=>l(n).addChatroom(`Playground ${Object.keys(l(n).rooms).length+1}`))},[p(l(b),{id:"add","w-1.8em":"","h-1.8em":""}),A]),d("ul",{"list-none":"","p-0":"","w-full":"","box-border":"",onClick:c,onDblclick:m,onKeydown:S(u,["enter"])},[(r(!0),i(v,null,k(l(n).rooms,t=>(r(),i("li",{key:t.uuid,"data-chatroom-uuid":t.uuid,class:L(["list-item leading-0 py-5 !px-3 mb-2",{"bg-dark-500/40":l(n).current.uuid===t.uuid}]),hover:"bg-dark-500/40"},[p(l(b),{id:"chat","w-1.5em":"","h-1.5em":"","min-w-1.5em":"","data-chatroom-uuid":t.uuid},null,8,["data-chatroom-uuid"]),t.editTitle?C((r(),i("input",{key:0,"onUpdate:modelValue":_=>t.title=_,"inline-block":"","flex-1":"","w-30":"","ml-2":"",type:"text","data-chatroom-uuid":t.uuid,onBlur:_=>g(t.uuid)},null,40,Q)),[[$,t.title]]):(r(),i("span",{key:1,"inline-block":"","flex-1":"","ml-3":"","data-chatroom-uuid":t.uuid},w(t.title),9,R))],10,G))),128))],40,J)]))}});const X=I(W,[["__scopeId","data-v-c61c8707"]]),Y={class:"text-dark-300 flex w-100vw h-100vh box-border"},tt=f({__name:"index",setup(s){return(a,n)=>(r(),i("div",Y,[p(X),p(K)]))}});export{tt as default};
