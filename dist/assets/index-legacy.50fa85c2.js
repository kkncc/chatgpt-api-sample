System.register(["./index-legacy.750c5dd3.js"],(function(e,t){"use strict";var o,r,a,n,i,l,d,s,u,c,m,b,g,p,h,f,v,y,x,w,k,C,_=document.createElement("style");return _.textContent='.message[data-v-b77d68c2]{float:left;margin-bottom:.5rem;box-sizing:border-box;display:block;width:auto;height:auto;white-space:pre-wrap;border-width:2px;--un-border-opacity:1;border-color:rgba(229,231,235,var(--un-border-opacity));border-radius:.5rem;border-style:solid;padding:.5rem;line-height:1.5em}.clearfix[data-v-b77d68c2]{content:" ";display:table;clear:both}.button[data-v-b77d68c2]{margin-left:.5rem;width:5em;border-width:1px;--un-border-opacity:1;border-color:rgba(209,213,219,var(--un-border-opacity));border-radius:.25rem;--un-bg-opacity:1;background-color:rgba(96,165,250,var(--un-bg-opacity));background-image:none;font-weight:700;--un-text-opacity:1;color:rgba(255,255,255,var(--un-text-opacity));outline:2px solid transparent;outline-offset:2px}.list-item[data-v-cc82e62c]{position:relative;box-sizing:border-box;width:100%;display:flex;cursor:pointer;align-items:center;justify-content:flex-start;border-radius:.5rem;padding-left:.5rem}\n',document.head.appendChild(_),{setters:[e=>{o=e.d,r=e.u,a=e.r,n=e.a,i=e.o,l=e.c,d=e.b,s=e.e,u=e.f,c=e.F,m=e.g,b=e.h,g=e.w,p=e.v,h=e.i,f=e.t,v=e.n,y=e.p,x=e.j,w=e._,k=e.k,C=e.l}],execute:function(){var t=(e=>(e[e.Ok=200]="Ok",e[e.BadRequest=400]="BadRequest",e[e.InteralServerError=500]="InteralServerError",e))(t||{});const _={flex:"","flex-col":"","flex-1":"","p-1":"","pl-0":""},B={class:"flex-1 w-full m-auto p-4 rounded-lg box-border overflow-hidden"},T={key:0,class:"message"},E={key:1,class:"message !float-right"},I=(e=>(y("data-v-b77d68c2"),e=e(),x(),e))((()=>u("div",{class:"clearfix"},null,-1))),S={class:"mt-4"},K={class:"flex w-full h-4em px-4 my-4 box-border"},j=["onKeydown"],O=w(o({__name:"ChatView",setup(e){const o=r(),y=a({editContent:"",editing:!1}),x=n();i((()=>{x.value&&x.value.scrollTo({top:x.value.scrollHeight})}));const w=l((()=>o.current.messages)),k=()=>{v((()=>{x.value&&(x.value.scrollTop=x.value.scrollHeight)}))},C=async e=>{if(e&&(e.preventDefault(),!e.metaKey&&!e.ctrlKey))return;if(y.editing)return;if(!y.editContent)return void window.alert("请输入信息");o.current.messages.push({sentBy:"human",content:y.editContent}),k(),y.editContent="";const{uuid:r}=o.current;try{const e=await window.fetch("/api/chat",{body:JSON.stringify({prompt:w.value[w.value.length-1].content,conversation_id:r}),headers:{"Content-Type":"application/json"},method:"POST"});let a;switch(e.status){case t.Ok:e.json().then((e=>{o.current.messages.push({sentBy:"chat-gpt",content:e.ai_text}),o.rooms[r]=o.current,k()}));break;case t.BadRequest:a="请求参数错误";break;case t.InteralServerError:a="服务器错误";break;default:a="未知错误"}if(void 0!==a)throw new Error(`${a}，请重新发送消息`)}catch(a){window.alert(a.message)}},O=()=>{window.fetch("/api/reset").then((()=>{o.resetChatroom(o.current.uuid),console.log(o.current)}))};return(e,t)=>(d(),s("div",_,[u("div",B,[u("div",{ref_key:"messagesBox",ref:x,class:"h-full overflow-auto transition-all"},[(d(!0),s(c,null,m(b(w),((e,t)=>(d(),s(c,{key:t},["chat-gpt"===e.sentBy?(d(),s("div",T,f(e.content),1)):(d(),s("div",E,f(e.content),1)),I],64)))),128))],512)]),u("div",S,[u("div",K,[g(u("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>y.editContent=e),contenteditable:"",class:"flex-1 p-2 b-gray-300 b-solid b-2 rounded-lg",onCompositionstart:t[1]||(t[1]=()=>y.editing=!0),onCompositionend:t[2]||(t[2]=()=>y.editing=!1),onKeyup:t[3]||(t[3]=h((e=>e.preventDefault()),["enter"])),onKeydown:h(C,["enter"])},null,40,j),[[p,y.editContent]]),u("button",{class:"button",title:"【Ctrl/Meta + Enter】发送",onClick:t[4]||(t[4]=()=>C())}," Submit "),u("button",{class:"button",onClick:O}," Clear ")])])]))}}),[["__scopeId","data-v-b77d68c2"]]),H=["xlink:href"],U=o({__name:"BaseIcon",props:{fileUrl:{default:"icons.svg"},id:null},setup(e){const t=e,o=l((()=>`${t.fileUrl}#${t.id}`));return(e,t)=>(d(),s("svg",null,[u("use",{"xlink:href":b(o)},null,8,H)]))}}),V={"w-50":"","p-1":"","box-border":"","leading-3em":"","text-left":"",bg:"gray-7",text:"white"},L=(e=>(y("data-v-cc82e62c"),e=e(),x(),e))((()=>u("span",{"ml-2":""},"New Chat",-1))),M=["onKeydown"],q=["data-chatroom-uuid"],D=["onUpdate:modelValue","data-chatroom-uuid","onBlur"],N=["data-chatroom-uuid"],R=w(o({__name:"ChatroomList",setup(e){const t=e=>e.getAttribute("data-chatroom-uuid"),o=r(),a=e=>{if(e.target instanceof HTMLElement||e.target instanceof SVGElement){const r=t(e.target),a=e.target.getAttribute("data-action");if(r)if("delete"===a){if(1===Object.keys(o.rooms).length)return;if(delete o.rooms[r],r===o.current.uuid){const e=o.getChatroomsByIndex();o.current=e[e.length-1]}}else o.current=o.rooms[r]}},n=e=>{if(e.target instanceof HTMLElement){const r=t(e.target);if(r){const e=o.rooms[r];e&&(e.editTitle=!0)}}},i=e=>{if(e.target instanceof HTMLElement){const r=t(e.target);if(r){const e=o.rooms[r];e&&e.editTitle&&(e.editTitle=!1)}}};return(e,t)=>(d(),s("div",V,[u("div",{b:"1 solid gray-4 rounded-lg",class:"list-item",onClick:t[0]||(t[0]=e=>b(o).addChatroom())},[k(b(U),{id:"add","w-1.8em":"","h-1.8em":""}),L]),u("ul",{"list-none":"","p-0":"","w-full":"","box-border":"",onClick:a,onDblclick:n,onKeydown:h(i,["enter"])},[(d(!0),s(c,null,m(b(o).getChatroomsByIndex(),(e=>(d(),s("li",{key:e.uuid,"data-chatroom-uuid":e.uuid,class:C(["list-item leading-0 py-5 !px-3 mb-2 group",{"bg-dark-500/40":b(o).current.uuid===e.uuid}]),hover:"bg-dark-500/40","data-action":"switch"},[k(b(U),{id:"chat","w-1.5em":"","h-1.5em":"","min-w-1.5em":"","data-chatroom-uuid":e.uuid},null,8,["data-chatroom-uuid"]),e.editTitle?g((d(),s("input",{key:0,"onUpdate:modelValue":t=>e.title=t,"inline-block":"","flex-1":"","w-30":"","ml-2":"",type:"text","data-chatroom-uuid":e.uuid,onBlur:t=>(e=>{const t=o.rooms[e];""===t.title&&(t.title="No name"),t.editTitle=!1})(e.uuid)},null,40,D)),[[p,e.title]]):(d(),s("span",{key:1,"inline-block":"","flex-1":"","ml-3":"","data-chatroom-uuid":e.uuid},f(e.title),9,N)),k(b(U),{id:"delete","w-1em":"","h-1em":"","display-none":"",absolute:"","right-2":"","top-2":"","group-hover":"block","data-chatroom-uuid":e.uuid,"data-action":"delete"},null,8,["data-chatroom-uuid"])],10,q)))),128))],40,M)]))}}),[["__scopeId","data-v-cc82e62c"]]),$={class:"text-dark-300 flex w-100vw h-100vh box-border"};e("default",o({__name:"index",setup:e=>(e,t)=>(d(),s("div",$,[k(R),k(O)]))}))}}}));
