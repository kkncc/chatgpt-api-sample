import{d as g,u as C,r as V,a as K,o as M,c as B,b as d,e as c,f as l,F as w,g as $,h as u,w as T,v as E,i as x,t as y,n as O,p as I,j as L,_ as S,k as m,l as U}from"./index-3399cb75.js";var p=(s=>(s[s.Ok=200]="Ok",s[s.BadRequest=400]="BadRequest",s[s.InteralServerError=500]="InteralServerError",s))(p||{});const j=s=>(I("data-v-d220fc25"),s=s(),L(),s),D={flex:"","flex-col":"","flex-1":"","p-1":"","pl-0":""},H={class:"flex-1 w-full m-auto p-4 rounded-lg box-border overflow-hidden"},N={key:0,class:"message"},q={key:1,class:"message !float-right"},A=j(()=>l("div",{class:"clearfix"},null,-1)),F={class:"mt-4"},z={class:"flex w-full h-4em px-4 my-4 box-border"},G=["onKeydown"],J=g({__name:"ChatView",setup(s){const r=C(),a=V({editContent:"",editing:!1}),o=K();M(()=>{o.value&&o.value.scrollTo({top:o.value.scrollHeight})});const _=B(()=>r.current.messages),h=()=>{O(()=>{o.value&&(o.value.scrollTop=o.value.scrollHeight)})},f=async n=>{if(n){if(!n.metaKey&&!n.ctrlKey)return;n.preventDefault()}if(a.editing)return;if(!a.editContent){window.alert("请输入信息");return}r.current.messages.push({sentBy:"human",content:a.editContent}),h(),a.editContent="";const{uuid:e}=r.current;try{const t=await window.fetch("/api/chat",{body:JSON.stringify({prompt:_.value[_.value.length-1].content,conversation_id:e}),headers:{"Content-Type":"application/json"},method:"POST"});let i;switch(t.status){case p.Ok:t.json().then(k=>{r.current.messages.push({sentBy:"chat-gpt",content:k.ai_text}),r.rooms[e]=r.current,h()});break;case p.BadRequest:i="请求参数错误";break;case p.InteralServerError:i="服务器错误";break;default:i="未知错误"}if(i!==void 0)throw new Error(`${i}，请重新发送消息`)}catch(t){window.alert(t.message)}},v=()=>{window.fetch("/api/reset").then(()=>{r.resetChatroom(r.current.uuid),console.log(r.current)})};return(n,e)=>(d(),c("div",D,[l("div",H,[l("div",{ref_key:"messagesBox",ref:o,class:"h-full overflow-auto transition-all pr-4"},[(d(!0),c(w,null,$(u(_),(t,i)=>(d(),c(w,{key:i},[t.sentBy==="chat-gpt"?(d(),c("div",N,y(t.content),1)):(d(),c("div",q,y(t.content),1)),A],64))),128))],512)]),l("div",F,[l("div",z,[T(l("textarea",{"onUpdate:modelValue":e[0]||(e[0]=t=>a.editContent=t),contenteditable:"",class:"flex-1 p-2 b-gray-300 b-solid b-2 rounded-lg",onCompositionstart:e[1]||(e[1]=()=>a.editing=!0),onCompositionend:e[2]||(e[2]=()=>a.editing=!1),onKeyup:e[3]||(e[3]=x(t=>t.preventDefault(),["enter"])),onKeydown:x(f,["enter"])},null,40,G),[[E,a.editContent]]),l("button",{class:"button send-btn relative",title:"【Ctrl/Meta + Enter】发送",onClick:e[4]||(e[4]=()=>f())}," 发送 "),l("button",{class:"button",onClick:v}," 清除 ")])])]))}});const P=S(J,[["__scopeId","data-v-d220fc25"]]),Q=["xlink:href"],b=g({__name:"BaseIcon",props:{fileUrl:{default:"icons.svg"},id:null},setup(s){const r=s,a=B(()=>`${r.fileUrl}#${r.id}`);return(o,_)=>(d(),c("svg",null,[l("use",{"xlink:href":u(a),"pointer-events":"none"},null,8,Q)]))}}),R=s=>(I("data-v-8f68506b"),s=s(),L(),s),W={"w-50":"","p-1":"","box-border":"","leading-3em":"","text-left":"",bg:"gray-7",text:"white"},X=R(()=>l("span",{"ml-2":""},"New Chat",-1)),Y=["onKeydown"],Z=["data-chatroom-uuid"],tt=["onUpdate:modelValue","data-chatroom-uuid","onBlur"],et=["data-chatroom-uuid"],ot=g({__name:"ChatroomList",setup(s){const r=n=>n.getAttribute("data-chatroom-uuid"),a=n=>n.getAttribute("data-action"),o=C(),_=n=>{if(n.target instanceof HTMLElement||n.target instanceof SVGElement){const e=r(n.target),t=a(n.target);if(e)if(t==="delete"){if(Object.keys(o.rooms).length===1)return;if(delete o.rooms[e],e===o.current.uuid){const i=o.getChatroomsByIndex();o.current=i[i.length-1]}}else o.current=o.rooms[e]}},h=n=>{if(n.target instanceof HTMLElement){const e=r(n.target);if(e){const t=o.rooms[e];t&&(t.editTitle=!0)}}},f=n=>{const e=o.rooms[n];e.title===""&&(e.title="No name"),e.editTitle=!1},v=n=>{if(n.target instanceof HTMLElement){const e=r(n.target);if(e){const t=o.rooms[e];t&&t.editTitle&&(t.editTitle=!1)}}};return(n,e)=>(d(),c("div",W,[l("div",{b:"1 solid gray-4 rounded-lg",class:"list-item",onClick:e[0]||(e[0]=t=>u(o).addChatroom())},[m(u(b),{id:"add","w-1.8em":"","h-1.8em":""}),X]),l("ul",{"list-none":"","p-0":"","w-full":"","box-border":"",onClick:_,onDblclick:h,onKeydown:x(v,["enter"])},[(d(!0),c(w,null,$(u(o).getChatroomsByIndex(),t=>(d(),c("li",{key:t.uuid,"data-chatroom-uuid":t.uuid,class:U(["list-item leading-0 py-5 !px-3 mb-2 group",{"bg-dark-500/40":u(o).current.uuid===t.uuid}]),hover:"bg-dark-500/40","data-action":"switch"},[m(u(b),{id:"chat","w-1.5em":"","h-1.5em":"","min-w-1.5em":"","data-chatroom-uuid":t.uuid},null,8,["data-chatroom-uuid"]),t.editTitle?T((d(),c("input",{key:0,"onUpdate:modelValue":i=>t.title=i,"inline-block":"","flex-1":"","w-30":"","ml-2":"",type:"text","data-chatroom-uuid":t.uuid,onBlur:i=>f(t.uuid)},null,40,tt)),[[E,t.title]]):(d(),c("span",{key:1,"inline-block":"","flex-1":"","ml-3":"","data-chatroom-uuid":t.uuid},y(t.title),9,et)),m(u(b),{id:"delete","w-1em":"","h-1em":"","display-none":"",absolute:"","right-2":"","top-1":"","group-hover":Object.keys(u(o).rooms).length>1?"block":"","data-chatroom-uuid":t.uuid,"data-action":"delete"},null,8,["group-hover","data-chatroom-uuid"])],10,Z))),128))],40,Y)]))}});const nt=S(ot,[["__scopeId","data-v-8f68506b"]]),st={class:"text-dark-300 flex w-100vw h-100vh box-border"},at=g({__name:"index",setup(s){return(r,a)=>(d(),c("div",st,[m(nt),m(P)]))}});export{at as default};
