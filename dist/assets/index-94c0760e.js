import{d as f,u as k,r as V,c as C,o as d,a as l,b as c,F as v,e as $,f as u,w as B,v as E,g as w,t as y,p as T,h as I,_ as S,i as h,n as K}from"./index-bce44d43.js";var p=(n=>(n[n.Ok=200]="Ok",n[n.BadRequest=400]="BadRequest",n[n.InteralServerError=500]="InteralServerError",n))(p||{});const L=n=>(T("data-v-f0325ab7"),n=n(),I(),n),U={flex:"","flex-col":"","flex-1":"","p-1":"","pl-0":""},O={class:"flex-1 w-full m-auto p-4 rounded-lg box-border"},D={key:0,class:"message"},M={key:1,class:"message !float-right"},N=L(()=>c("div",{class:"clearfix"},null,-1)),j={class:"mt-4"},q={class:"flex w-full h-4em px-4 my-4 box-border"},A=["onKeydown"],H=f({__name:"ChatView",setup(n){const s=k(),i=V({editContent:"",editing:!1}),a=C(()=>s.current.messages),m=async _=>{if(_&&(_.preventDefault(),!_.metaKey&&!_.ctrlKey)||i.editing)return;if(!i.editContent){window.alert("请输入信息");return}s.current.messages.push({sentBy:"human",content:i.editContent}),i.editContent="";const{uuid:r}=s.current;try{const t=await window.fetch("/api/chat",{body:JSON.stringify({prompt:a.value[a.value.length-1].content,conversation_id:r}),headers:{"Content-Type":"application/json"},method:"POST"});let o;switch(t.status){case p.Ok:t.json().then(e=>{s.rooms[r].messages.push({sentBy:"chat-gpt",content:e.ai_text})});break;case p.BadRequest:o="请求参数错误";break;case p.InteralServerError:o="服务器错误";break;default:o="未知错误"}if(o!==void 0)throw new Error(`${o}，请重新发送消息`)}catch(t){window.alert(t.message)}},g=()=>{window.fetch("/api/reset").then(()=>{s.resetChatroom(s.current.uuid),console.log(s.current)})};return(_,r)=>(d(),l("div",U,[c("div",O,[(d(!0),l(v,null,$(u(a),(t,o)=>(d(),l(v,{key:o},[t.sentBy==="chat-gpt"?(d(),l("div",D,y(t.content),1)):(d(),l("div",M,y(t.content),1)),N],64))),128))]),c("div",j,[c("div",q,[B(c("textarea",{"onUpdate:modelValue":r[0]||(r[0]=t=>i.editContent=t),contenteditable:"",class:"flex-1 p-2 b-gray-300 b-solid b-2 rounded-lg",onCompositionstart:r[1]||(r[1]=()=>i.editing=!0),onCompositionend:r[2]||(r[2]=()=>i.editing=!1),onKeyup:r[3]||(r[3]=w(t=>t.preventDefault(),["enter"])),onKeydown:w(m,["enter"])},null,40,A),[[E,i.editContent]]),c("button",{class:"button",title:"【Ctrl/Meta + Enter】发送",onClick:r[4]||(r[4]=()=>m())}," Submit "),c("button",{class:"button",onClick:g}," Clear ")])])]))}});const F=S(H,[["__scopeId","data-v-f0325ab7"]]),P=["xlink:href"],b=f({__name:"BaseIcon",props:{fileUrl:{default:"icons.svg"},id:null},setup(n){const s=n,i=C(()=>`${s.fileUrl}#${s.id}`);return(a,m)=>(d(),l("svg",null,[c("use",{"xlink:href":u(i)},null,8,P)]))}}),z=n=>(T("data-v-14a9fac3"),n=n(),I(),n),G={"w-50":"","p-1":"","box-border":"","leading-3em":"","text-left":"",bg:"gray-7",text:"white"},J=z(()=>c("span",{"ml-2":""},"New Chat",-1)),Q=["onKeydown"],R=["data-chatroom-uuid"],W=["onUpdate:modelValue","data-chatroom-uuid","onBlur"],X=["data-chatroom-uuid"],Y=f({__name:"ChatroomList",setup(n){const s=t=>t.getAttribute("data-chatroom-uuid"),i=t=>t.getAttribute("data-action"),a=k(),m=t=>{if(t.target instanceof HTMLElement||t.target instanceof SVGElement){const o=s(t.target),e=i(t.target);o&&(e==="delete"?delete a.rooms[o]:a.current=a.rooms[o])}},g=t=>{if(t.target instanceof HTMLElement){const o=s(t.target);if(o){const e=a.rooms[o];e&&(e.editTitle=!0)}}},_=t=>{const o=a.rooms[t];o.title===""&&(o.title="No name"),o.editTitle=!1},r=t=>{if(t.target instanceof HTMLElement){const o=s(t.target);if(o){const e=a.rooms[o];e&&e.editTitle&&(e.editTitle=!1)}}};return(t,o)=>(d(),l("div",G,[c("div",{b:"1 solid gray-4 rounded-lg",class:"list-item",onClick:o[0]||(o[0]=e=>u(a).addChatroom(`Playground ${Object.keys(u(a).rooms).length+1}`))},[h(u(b),{id:"add","w-1.8em":"","h-1.8em":""}),J]),c("ul",{"list-none":"","p-0":"","w-full":"","box-border":"",onClick:m,onDblclick:g,onKeydown:w(r,["enter"])},[(d(!0),l(v,null,$(u(a).rooms,e=>(d(),l("li",{key:e.uuid,"data-chatroom-uuid":e.uuid,class:K(["list-item leading-0 py-5 !px-3 mb-2 group",{"bg-dark-500/40":u(a).current.uuid===e.uuid}]),hover:"bg-dark-500/40","data-action":"switch"},[h(u(b),{id:"chat","w-1.5em":"","h-1.5em":"","min-w-1.5em":"","data-chatroom-uuid":e.uuid},null,8,["data-chatroom-uuid"]),e.editTitle?B((d(),l("input",{key:0,"onUpdate:modelValue":x=>e.title=x,"inline-block":"","flex-1":"","w-30":"","ml-2":"",type:"text","data-chatroom-uuid":e.uuid,onBlur:x=>_(e.uuid)},null,40,W)),[[E,e.title]]):(d(),l("span",{key:1,"inline-block":"","flex-1":"","ml-3":"","data-chatroom-uuid":e.uuid},y(e.title),9,X)),h(u(b),{id:"delete","w-1em":"","h-1em":"","display-none":"",absolute:"","right-2":"","top-2":"","group-hover":"block","data-chatroom-uuid":e.uuid,"data-action":"delete"},null,8,["data-chatroom-uuid"])],10,R))),128))],40,Q)]))}});const Z=S(Y,[["__scopeId","data-v-14a9fac3"]]),tt={class:"text-dark-300 flex w-100vw h-100vh box-border"},ot=f({__name:"index",setup(n){return(s,i)=>(d(),l("div",tt,[h(Z),h(F)]))}});export{ot as default};
