import{d as f,u as y,r as S,c as k,o as r,a as i,b as d,F as v,e as C,f as l,w as $,v as B,g as w,t as b,p as T,h as I,_ as E,i as p,n as L}from"./index-f0df3991.js";var h=(s=>(s[s.Ok=200]="Ok",s[s.BadRequest=400]="BadRequest",s[s.InteralServerError=500]="InteralServerError",s))(h||{});const V=s=>(T("data-v-815aeeac"),s=s(),I(),s),U={flex:"","flex-col":"","flex-1":"","p-1":"","pl-0":""},K={class:"flex-1 w-full m-auto p-4 rounded-lg box-border"},O={key:0,class:"message"},D={key:1,class:"message !float-right"},N=V(()=>d("div",{class:"clearfix"},null,-1)),M={class:"mt-4"},j={class:"flex w-full h-4em px-4 my-4 box-border"},q=["onKeydown"],H=f({__name:"ChatView",setup(s){const a=y(),n=S({editContent:"",editing:!1}),c=k(()=>a.current.messages),_=async u=>{if(u==null||u.preventDefault(),n.editing)return;if(!n.editContent){window.alert("请输入信息");return}a.current.messages.push({sentBy:"human",content:n.editContent}),n.editContent="";const{uuid:o}=a.current;try{const t=await window.fetch("/api/chat",{body:JSON.stringify({prompt:c.value[c.value.length-1].content,conversation_id:o}),headers:{"Content-Type":"application/json"},method:"POST"});let e;switch(t.status){case h.Ok:t.json().then(m=>{a.rooms[o].messages.push({sentBy:"chat-gpt",content:m.ai_text})});break;case h.BadRequest:e="请求参数错误";break;case h.InteralServerError:e="服务器错误";break;default:e="未知错误"}if(e!==void 0)throw new Error(`${e}，请重新发送消息`)}catch(t){window.alert(t.message)}},g=()=>{window.fetch("/api/reset").then(()=>{a.resetChatroom(a.current.uuid),console.log(a.current)})};return(u,o)=>(r(),i("div",U,[d("div",K,[(r(!0),i(v,null,C(l(c),(t,e)=>(r(),i(v,{key:e},[t.sentBy==="chat-gpt"?(r(),i("div",O,b(t.content),1)):(r(),i("div",D,b(t.content),1)),N],64))),128))]),d("div",M,[d("div",j,[$(d("textarea",{"onUpdate:modelValue":o[0]||(o[0]=t=>n.editContent=t),contenteditable:"",class:"flex-1 p-2 b-gray-300 b-solid b-2 rounded-lg",onCompositionstart:o[1]||(o[1]=()=>n.editing=!0),onCompositionend:o[2]||(o[2]=()=>n.editing=!1),onKeyup:o[3]||(o[3]=w(t=>t.preventDefault(),["enter"])),onKeydown:w(_,["enter"])},null,40,q),[[B,n.editContent]]),d("button",{class:"button",onClick:_}," Submit "),d("button",{class:"button",onClick:g}," Clear ")])])]))}});const F=E(H,[["__scopeId","data-v-815aeeac"]]),P=["xlink:href"],x=f({__name:"BaseIcon",props:{fileUrl:{default:"icons.svg"},id:null},setup(s){const a=s,n=k(()=>`${a.fileUrl}#${a.id}`);return(c,_)=>(r(),i("svg",null,[d("use",{"xlink:href":l(n)},null,8,P)]))}}),z=s=>(T("data-v-c61c8707"),s=s(),I(),s),A={"w-50":"","p-1":"","box-border":"","leading-3em":"","text-left":"",bg:"gray-7",text:"white"},J=z(()=>d("span",{"ml-2":""},"New Chat",-1)),G=["onKeydown"],Q=["data-chatroom-uuid"],R=["onUpdate:modelValue","data-chatroom-uuid","onBlur"],W=["data-chatroom-uuid"],X=f({__name:"ChatroomList",setup(s){const a=o=>o.getAttribute("data-chatroom-uuid"),n=y(),c=o=>{if(o.target instanceof HTMLLIElement){const t=a(o.target);t&&(n.current=n.rooms[t])}},_=o=>{if(o.target instanceof HTMLElement){const t=a(o.target);if(t){const e=n.rooms[t];e&&(e.editTitle=!0)}}},g=o=>{const t=n.rooms[o];t.title===""&&(t.title="No name"),t.editTitle=!1},u=o=>{if(o.target instanceof HTMLElement){const t=a(o.target);if(t){const e=n.rooms[t];e&&e.editTitle&&(e.editTitle=!1)}}};return(o,t)=>(r(),i("div",A,[d("div",{b:"1 solid gray-4 rounded-lg",class:"list-item",onClick:t[0]||(t[0]=e=>l(n).addChatroom(`Playground ${Object.keys(l(n).rooms).length+1}`))},[p(l(x),{id:"add","w-1.8em":"","h-1.8em":""}),J]),d("ul",{"list-none":"","p-0":"","w-full":"","box-border":"",onClick:c,onDblclick:_,onKeydown:w(u,["enter"])},[(r(!0),i(v,null,C(l(n).rooms,e=>(r(),i("li",{key:e.uuid,"data-chatroom-uuid":e.uuid,class:L(["list-item leading-0 py-5 !px-3 mb-2",{"bg-dark-500/40":l(n).current.uuid===e.uuid}]),hover:"bg-dark-500/40"},[p(l(x),{id:"chat","w-1.5em":"","h-1.5em":"","min-w-1.5em":"","data-chatroom-uuid":e.uuid},null,8,["data-chatroom-uuid"]),e.editTitle?$((r(),i("input",{key:0,"onUpdate:modelValue":m=>e.title=m,"inline-block":"","flex-1":"","w-30":"","ml-2":"",type:"text","data-chatroom-uuid":e.uuid,onBlur:m=>g(e.uuid)},null,40,R)),[[B,e.title]]):(r(),i("span",{key:1,"inline-block":"","flex-1":"","ml-3":"","data-chatroom-uuid":e.uuid},b(e.title),9,W))],10,Q))),128))],40,G)]))}});const Y=E(X,[["__scopeId","data-v-c61c8707"]]),Z={class:"text-dark-300 flex w-100vw h-100vh box-border"},et=f({__name:"index",setup(s){return(a,n)=>(r(),i("div",Z,[p(Y),p(F)]))}});export{et as default};
